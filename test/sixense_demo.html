<!DOCTYPE html>
<html>
  <head>
    <title>NPVR Sixense Demo</title>
    <script src="../lib/vr.js"></script>
    <script src="../third_party/three.js/three.min.js"></script>
  </head>
  <body>
    <script>
      var canvasWidth = 800;
      var canvasHeight = 600;
      var cameraViewAngle = 45;
      var cameraAspect = canvasWidth / canvasHeight;
      var cameraNear = 0.1;
      var cameraFar = 10000;
      var camera = new THREE.PerspectiveCamera(
          cameraViewAngle, cameraAspect, cameraNear, cameraFar);

      var scene = new THREE.Scene();
      scene.add(camera);
      camera.position.z = 800;

      var renderer = new THREE.WebGLRenderer();
      renderer.setSize(canvasWidth, canvasHeight);
      document.body.appendChild(renderer.domElement);

      var pointLight = new THREE.PointLight(0xFFFFFF);
      pointLight.position.x = 10;
      pointLight.position.y = 50;
      pointLight.position.z = 130;
      scene.add(pointLight);

      function createPointer() {
        var container = new THREE.Object3D();
        container.useQuaternion = true;
        scene.add(container);

        var arrow = new THREE.ArrowHelper(
            new THREE.Vector3(0, 0, -1),
            new THREE.Vector3(0, 0, 0),
            50,
            0x00CC00);
        container.add(arrow);

        var axis = new THREE.AxisHelper(50);
        container.add(axis);

        return {
          container: container,
        };
      };

      function updatePointer(pointer, controller) {
        var container = pointer.container;
        container.position.x = controller.position[0];
        container.position.y = controller.position[1];
        container.position.z = controller.position[2];
        container.quaternion.x = controller.rotation[0];
        container.quaternion.y = controller.rotation[1];
        container.quaternion.z = controller.rotation[2];
        container.quaternion.w = controller.rotation[3];
        // TODO(benvanik): change colors with buttons/etc
      };

      var pointer0 = createPointer();
      var pointer1 = createPointer();

      var vrstate = vr.createState();
      function tick() {
        // Poll VR, if it's ready.
        if (vr.isReady) {
          vr.poll(vrstate);

          pointer0.visible = vrstate.sixense.present;
          pointer1.visible = vrstate.sixense.present;

          if (vrstate.sixense.present) {
            updatePointer(pointer0, vrstate.sixense.controllers[0]);
            updatePointer(pointer1, vrstate.sixense.controllers[1]);
          } else {
            // Not plugged in.
          }
        }

        renderer.render(scene, camera);
        window.mozRequestAnimationFrame(tick);
      };
      window.mozRequestAnimationFrame(tick);
    </script>
  </body>
</html>
